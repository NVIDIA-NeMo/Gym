{"responses_create_params": {"input": [{"role": "system", "content": "You are a SQL expert. Given a database schema and a natural language question, generate a SQLite query that answers the question. Return only the SQL query inside a ```sql``` code block."}, {"role": "user", "content": "<DATABASE_SCHEMA>\nCREATE TABLE player (\n    player_id INTEGER,\n    player_name TEXT,\n    dob DATE,\n    batting_hand TEXT,\n    bowling_skill TEXT,\n    country_name TEXT\n);\n\nCREATE TABLE team (\n    team_id INTEGER,\n    name TEXT\n);\n\nCREATE TABLE match (\n    match_id INTEGER,\n    team_1 INTEGER,\n    team_2 INTEGER,\n    match_date DATE,\n    season_id INTEGER,\n    venue TEXT,\n    toss_winner INTEGER,\n    toss_decision TEXT,\n    win_type TEXT,\n    win_margin INTEGER,\n    outcome_type TEXT,\n    match_winner INTEGER,\n    man_of_the_match INTEGER\n);\n\nCREATE TABLE player_match (\n    match_id INTEGER,\n    player_id INTEGER,\n    role TEXT,\n    team_id INTEGER\n);\n\nCREATE TABLE ball_by_ball (\n    match_id INTEGER,\n    over_id INTEGER,\n    ball_id INTEGER,\n    innings_no INTEGER,\n    team_batting INTEGER,\n    team_bowling INTEGER,\n    striker_batting_position INTEGER,\n    striker INTEGER,\n    non_striker INTEGER,\n    bowler INTEGER\n);\n\nCREATE TABLE batsman_scored (\n    match_id INTEGER,\n    over_id INTEGER,\n    ball_id INTEGER,\n    runs_scored INTEGER,\n    innings_no INTEGER\n);\n\nCREATE TABLE wicket_taken (\n    match_id INTEGER,\n    over_id INTEGER,\n    ball_id INTEGER,\n    player_out INTEGER,\n    kind_out TEXT,\n    innings_no INTEGER\n);\n\nCREATE TABLE extra_runs (\n    match_id INTEGER,\n    over_id INTEGER,\n    ball_id INTEGER,\n    extra_type TEXT,\n    extra_runs INTEGER,\n    innings_no INTEGER\n);\n</DATABASE_SCHEMA>\n\n<QUESTION>\nRetrieve the names of players who scored no less than 100 runs in a match while playing for the team that lost that match.\n</QUESTION>"}]}, "instance_id": "local022", "db_id": "IPL", "question": "Retrieve the names of players who scored no less than 100 runs in a match while playing for the team that lost that match.", "gold_sql": "-- Step 1: Calculate players' total runs in each match\nWITH player_runs AS (\n    SELECT \n        bbb.striker AS player_id, \n        bbb.match_id, \n        SUM(bsc.runs_scored) AS total_runs \n    FROM \n        ball_by_ball AS bbb\n    JOIN \n        batsman_scored AS bsc\n    ON \n        bbb.match_id = bsc.match_id \n        AND bbb.over_id = bsc.over_id \n        AND bbb.ball_id = bsc.ball_id \n        AND bbb.innings_no = bsc.innings_no\n    GROUP BY \n        bbb.striker, bbb.match_id\n    HAVING \n        SUM(bsc.runs_scored) >= 100\n),\n\n-- Step 2: Identify losing teams for each match\nlosing_teams AS (\n    SELECT \n        match_id, \n        CASE \n            WHEN match_winner = team_1 THEN team_2 \n            ELSE team_1 \n        END AS loser \n    FROM \n        match\n),\n\n-- Step 3: Combine the above results to get players who scored 100 or more runs in losing teams\nplayers_in_losing_teams AS (\n    SELECT \n        pr.player_id, \n        pr.match_id \n    FROM \n        player_runs AS pr\n    JOIN \n        losing_teams AS lt\n    ON \n        pr.match_id = lt.match_id\n    JOIN \n        player_match AS pm\n    ON \n        pr.player_id = pm.player_id \n        AND pr.match_id = pm.match_id \n        AND lt.loser = pm.team_id\n)\n\n-- Step 4: Select distinct player names from the player table\nSELECT DISTINCT \n    p.player_name \nFROM \n    player AS p\nJOIN \n    players_in_losing_teams AS plt\nON \n    p.player_id = plt.player_id\nORDER BY \n    p.player_name;", "ignore_order": true, "condition_cols": []}
{"responses_create_params": {"input": [{"role": "system", "content": "You are a SQL expert. Given a database schema and a natural language question, generate a SQLite query that answers the question. Return only the SQL query inside a ```sql``` code block."}, {"role": "user", "content": "<DATABASE_SCHEMA>\nCREATE TABLE player (\n    player_id INTEGER,\n    player_name TEXT,\n    dob DATE,\n    batting_hand TEXT,\n    bowling_skill TEXT,\n    country_name TEXT\n);\n\nCREATE TABLE team (\n    team_id INTEGER,\n    name TEXT\n);\n\nCREATE TABLE match (\n    match_id INTEGER,\n    team_1 INTEGER,\n    team_2 INTEGER,\n    match_date DATE,\n    season_id INTEGER,\n    venue TEXT,\n    toss_winner INTEGER,\n    toss_decision TEXT,\n    win_type TEXT,\n    win_margin INTEGER,\n    outcome_type TEXT,\n    match_winner INTEGER,\n    man_of_the_match INTEGER\n);\n\nCREATE TABLE player_match (\n    match_id INTEGER,\n    player_id INTEGER,\n    role TEXT,\n    team_id INTEGER\n);\n\nCREATE TABLE ball_by_ball (\n    match_id INTEGER,\n    over_id INTEGER,\n    ball_id INTEGER,\n    innings_no INTEGER,\n    team_batting INTEGER,\n    team_bowling INTEGER,\n    striker_batting_position INTEGER,\n    striker INTEGER,\n    non_striker INTEGER,\n    bowler INTEGER\n);\n\nCREATE TABLE batsman_scored (\n    match_id INTEGER,\n    over_id INTEGER,\n    ball_id INTEGER,\n    runs_scored INTEGER,\n    innings_no INTEGER\n);\n\nCREATE TABLE wicket_taken (\n    match_id INTEGER,\n    over_id INTEGER,\n    ball_id INTEGER,\n    player_out INTEGER,\n    kind_out TEXT,\n    innings_no INTEGER\n);\n\nCREATE TABLE extra_runs (\n    match_id INTEGER,\n    over_id INTEGER,\n    ball_id INTEGER,\n    extra_type TEXT,\n    extra_runs INTEGER,\n    innings_no INTEGER\n);\n</DATABASE_SCHEMA>\n\n<QUESTION>\nPlease help me find the names of top 5 players with the highest average runs per match in season 5, along with their batting averages.\n</QUESTION>"}]}, "instance_id": "local023", "db_id": "IPL", "question": "Please help me find the names of top 5 players with the highest average runs per match in season 5, along with their batting averages.", "gold_sql": "WITH runs_scored AS (\n    SELECT \n        bb.striker AS player_id,\n        bb.match_id,\n        bs.runs_scored AS runs\n    FROM \n        ball_by_ball AS bb\n    JOIN \n        batsman_scored AS bs ON bb.match_id = bs.match_id \n            AND bb.over_id = bs.over_id \n            AND bb.ball_id = bs.ball_id \n            AND bb.innings_no = bs.innings_no\n    WHERE \n        bb.match_id IN (SELECT match_id FROM match WHERE season_id = 5)\n),\ntotal_runs AS (\n    SELECT \n        player_id, \n        match_id, \n        SUM(runs) AS total_runs \n    FROM \n        runs_scored \n    GROUP BY \n        player_id, match_id\n),\nbatting_averages AS (\n    SELECT \n        player_id, \n        SUM(total_runs) AS runs, \n        COUNT(match_id) AS num_matches,\n        ROUND(SUM(total_runs) / CAST(COUNT(match_id) AS FLOAT), 3) AS batting_avg\n    FROM \n        total_runs \n    GROUP BY \n        player_id \n    ORDER BY \n        batting_avg DESC \n    LIMIT 5\n)\nSELECT \n    p.player_name,\n    b.batting_avg\nFROM \n    player AS p\nJOIN \n    batting_averages AS b ON p.player_id = b.player_id\nORDER BY \n    b.batting_avg DESC;", "ignore_order": true, "condition_cols": []}
{"responses_create_params": {"input": [{"role": "system", "content": "You are a SQL expert. Given a database schema and a natural language question, generate a SQLite query that answers the question. Return only the SQL query inside a ```sql``` code block."}, {"role": "user", "content": "<DATABASE_SCHEMA>\nCREATE TABLE actor (\n    actor_id numeric,\n    first_name VARCHAR(45),\n    last_name VARCHAR(45),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE country (\n    country_id SMALLINT,\n    country VARCHAR(50),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE city (\n    city_id INT,\n    city VARCHAR(50),\n    country_id SMALLINT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE address (\n    address_id INT,\n    address VARCHAR(50),\n    address2 VARCHAR(50),\n    district VARCHAR(20),\n    city_id INT,\n    postal_code VARCHAR(10),\n    phone VARCHAR(20),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE language (\n    language_id SMALLINT,\n    name CHAR(20),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE category (\n    category_id SMALLINT,\n    name VARCHAR(25),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE customer (\n    customer_id INT,\n    store_id INT,\n    first_name VARCHAR(45),\n    last_name VARCHAR(45),\n    email VARCHAR(50),\n    address_id INT,\n    active CHAR(1),\n    create_date TIMESTAMP,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE film (\n    film_id INT,\n    title VARCHAR(255),\n    description BLOB SUB_TYPE TEXT,\n    release_year VARCHAR(4),\n    language_id SMALLINT,\n    original_language_id SMALLINT,\n    rental_duration SMALLINT,\n    rental_rate DECIMAL(4,2),\n    length SMALLINT,\n    replacement_cost DECIMAL(5,2),\n    rating VARCHAR(10),\n    special_features VARCHAR(100),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE film_actor (\n    actor_id INT,\n    film_id INT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE film_category (\n    film_id INT,\n    category_id SMALLINT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE film_text (\n    film_id SMALLINT,\n    title VARCHAR(255),\n    description BLOB SUB_TYPE TEXT\n);\n\nCREATE TABLE inventory (\n    inventory_id INT,\n    film_id INT,\n    store_id INT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE staff (\n    staff_id SMALLINT,\n    first_name VARCHAR(45),\n    last_name VARCHAR(45),\n    address_id INT,\n    picture BLOB,\n    email VARCHAR(50),\n    store_id INT,\n    active SMALLINT,\n    username VARCHAR(16),\n    password VARCHAR(40),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE store (\n    store_id INT,\n    manager_staff_id SMALLINT,\n    address_id INT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE payment (\n    payment_id INT,\n    customer_id INT,\n    staff_id SMALLINT,\n    rental_id INT,\n    amount DECIMAL(5,2),\n    payment_date TIMESTAMP,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE rental (\n    rental_id INT,\n    rental_date TIMESTAMP,\n    inventory_id INT,\n    customer_id INT,\n    return_date TIMESTAMP,\n    staff_id SMALLINT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE customer_list (\n    ID INT,\n    name ,\n    address VARCHAR(50),\n    zip_code VARCHAR(10),\n    phone VARCHAR(20),\n    city VARCHAR(50),\n    country VARCHAR(50),\n    notes ,\n    SID INT\n);\n\nCREATE TABLE film_list (\n    FID INT,\n    title VARCHAR(255),\n    description BLOB SUB_TYPE TEXT,\n    category VARCHAR(25),\n    price DECIMAL(4,2),\n    length SMALLINT,\n    rating VARCHAR(10),\n    actors \n);\n\nCREATE TABLE staff_list (\n    ID SMALLINT,\n    name ,\n    address VARCHAR(50),\n    zip_code VARCHAR(10),\n    phone VARCHAR(20),\n    city VARCHAR(50),\n    country VARCHAR(50),\n    SID INT\n);\n\nCREATE TABLE sales_by_store (\n    store_id INT,\n    store ,\n    manager ,\n    total_sales \n);\n\nCREATE TABLE sales_by_film_category (\n    category VARCHAR(25),\n    total_sales \n);\n</DATABASE_SCHEMA>\n\n<QUESTION>\nCould you help me determine which actor starred most frequently in English-language children's category films that were rated either G or PG, had a running time of 120 minutes or less, and were released between 2000 and 2010? Please provide the actor's full name.\n</QUESTION>"}]}, "instance_id": "local038", "db_id": "Pagila", "question": "Could you help me determine which actor starred most frequently in English-language children's category films that were rated either G or PG, had a running time of 120 minutes or less, and were released between 2000 and 2010? Please provide the actor's full name.", "gold_sql": "SELECT\n    actor.first_name || ' ' || actor.last_name AS full_name\nFROM\n    actor\nINNER JOIN film_actor ON actor.actor_id = film_actor.actor_id\nINNER JOIN film ON film_actor.film_id = film.film_id\nINNER JOIN film_category ON film.film_id = film_category.film_id\nINNER JOIN category ON film_category.category_id = category.category_id\n-- Join with the language table\nINNER JOIN language ON film.language_id = language.language_id\nWHERE\n    category.name = 'Children' AND\n    film.release_year BETWEEN 2000 AND 2010 AND\n    film.rating IN ('G', 'PG') AND\n    language.name = 'English' AND\n    film.length <= 120\nGROUP BY\n    actor.actor_id, actor.first_name, actor.last_name\nORDER BY\n    COUNT(film.film_id) DESC\nLIMIT 1;", "ignore_order": true, "condition_cols": []}
{"responses_create_params": {"input": [{"role": "system", "content": "You are a SQL expert. Given a database schema and a natural language question, generate a SQLite query that answers the question. Return only the SQL query inside a ```sql``` code block."}, {"role": "user", "content": "<DATABASE_SCHEMA>\nCREATE TABLE actor (\n    actor_id numeric,\n    first_name VARCHAR(45),\n    last_name VARCHAR(45),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE country (\n    country_id SMALLINT,\n    country VARCHAR(50),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE city (\n    city_id INT,\n    city VARCHAR(50),\n    country_id SMALLINT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE address (\n    address_id INT,\n    address VARCHAR(50),\n    address2 VARCHAR(50),\n    district VARCHAR(20),\n    city_id INT,\n    postal_code VARCHAR(10),\n    phone VARCHAR(20),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE language (\n    language_id SMALLINT,\n    name CHAR(20),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE category (\n    category_id SMALLINT,\n    name VARCHAR(25),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE customer (\n    customer_id INT,\n    store_id INT,\n    first_name VARCHAR(45),\n    last_name VARCHAR(45),\n    email VARCHAR(50),\n    address_id INT,\n    active CHAR(1),\n    create_date TIMESTAMP,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE film (\n    film_id INT,\n    title VARCHAR(255),\n    description BLOB SUB_TYPE TEXT,\n    release_year VARCHAR(4),\n    language_id SMALLINT,\n    original_language_id SMALLINT,\n    rental_duration SMALLINT,\n    rental_rate DECIMAL(4,2),\n    length SMALLINT,\n    replacement_cost DECIMAL(5,2),\n    rating VARCHAR(10),\n    special_features VARCHAR(100),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE film_actor (\n    actor_id INT,\n    film_id INT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE film_category (\n    film_id INT,\n    category_id SMALLINT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE film_text (\n    film_id SMALLINT,\n    title VARCHAR(255),\n    description BLOB SUB_TYPE TEXT\n);\n\nCREATE TABLE inventory (\n    inventory_id INT,\n    film_id INT,\n    store_id INT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE staff (\n    staff_id SMALLINT,\n    first_name VARCHAR(45),\n    last_name VARCHAR(45),\n    address_id INT,\n    picture BLOB,\n    email VARCHAR(50),\n    store_id INT,\n    active SMALLINT,\n    username VARCHAR(16),\n    password VARCHAR(40),\n    last_update TIMESTAMP\n);\n\nCREATE TABLE store (\n    store_id INT,\n    manager_staff_id SMALLINT,\n    address_id INT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE payment (\n    payment_id INT,\n    customer_id INT,\n    staff_id SMALLINT,\n    rental_id INT,\n    amount DECIMAL(5,2),\n    payment_date TIMESTAMP,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE rental (\n    rental_id INT,\n    rental_date TIMESTAMP,\n    inventory_id INT,\n    customer_id INT,\n    return_date TIMESTAMP,\n    staff_id SMALLINT,\n    last_update TIMESTAMP\n);\n\nCREATE TABLE customer_list (\n    ID INT,\n    name ,\n    address VARCHAR(50),\n    zip_code VARCHAR(10),\n    phone VARCHAR(20),\n    city VARCHAR(50),\n    country VARCHAR(50),\n    notes ,\n    SID INT\n);\n\nCREATE TABLE film_list (\n    FID INT,\n    title VARCHAR(255),\n    description BLOB SUB_TYPE TEXT,\n    category VARCHAR(25),\n    price DECIMAL(4,2),\n    length SMALLINT,\n    rating VARCHAR(10),\n    actors \n);\n\nCREATE TABLE staff_list (\n    ID SMALLINT,\n    name ,\n    address VARCHAR(50),\n    zip_code VARCHAR(10),\n    phone VARCHAR(20),\n    city VARCHAR(50),\n    country VARCHAR(50),\n    SID INT\n);\n\nCREATE TABLE sales_by_store (\n    store_id INT,\n    store ,\n    manager ,\n    total_sales \n);\n\nCREATE TABLE sales_by_film_category (\n    category VARCHAR(25),\n    total_sales \n);\n</DATABASE_SCHEMA>\n\n<QUESTION>\nPlease help me find the film category with the highest total rental hours in cities where the city's name either starts with \"A\" or contains a hyphen. \n</QUESTION>"}]}, "instance_id": "local039", "db_id": "Pagila", "question": "Please help me find the film category with the highest total rental hours in cities where the city's name either starts with \"A\" or contains a hyphen. ", "gold_sql": "SELECT\n    category.name\nFROM\n    category\nINNER JOIN film_category USING (category_id)\nINNER JOIN film USING (film_id)\nINNER JOIN inventory USING (film_id)\nINNER JOIN rental USING (inventory_id)\nINNER JOIN customer USING (customer_id)\nINNER JOIN address USING (address_id)\nINNER JOIN city USING (city_id)\nWHERE\n    LOWER(city.city) LIKE 'a%' OR city.city LIKE '%-%'\nGROUP BY\n    category.name\nORDER BY\n    SUM(CAST((julianday(rental.return_date) - julianday(rental.rental_date)) * 24 AS INTEGER)) DESC\nLIMIT\n    1;", "ignore_order": true, "condition_cols": []}
{"responses_create_params": {"input": [{"role": "system", "content": "You are a SQL expert. Given a database schema and a natural language question, generate a SQLite query that answers the question. Return only the SQL query inside a ```sql``` code block."}, {"role": "user", "content": "<DATABASE_SCHEMA>\nCREATE TABLE victims (\n    id INTEGER,\n    case_id REAL,\n    party_number INTEGER,\n    victim_role TEXT,\n    victim_sex TEXT,\n    victim_age REAL,\n    victim_degree_of_injury TEXT,\n    victim_seating_position TEXT,\n    victim_safety_equipment_1 TEXT,\n    victim_safety_equipment_2 TEXT,\n    victim_ejected TEXT\n);\n\nCREATE TABLE collisions (\n    case_id REAL,\n    jurisdiction REAL,\n    officer_id TEXT,\n    reporting_district TEXT,\n    chp_shift TEXT,\n    population TEXT,\n    county_city_location INTEGER,\n    county_location TEXT,\n    special_condition REAL,\n    beat_type TEXT,\n    chp_beat_type TEXT,\n    city_division_lapd TEXT,\n    chp_beat_class TEXT,\n    beat_number TEXT,\n    primary_road TEXT,\n    secondary_road TEXT,\n    distance REAL,\n    direction TEXT,\n    intersection REAL,\n    weather_1 TEXT,\n    weather_2 TEXT,\n    state_highway_indicator REAL,\n    caltrans_county TEXT,\n    caltrans_district REAL,\n    state_route REAL,\n    route_suffix TEXT,\n    postmile_prefix TEXT,\n    postmile REAL,\n    location_type TEXT,\n    ramp_intersection TEXT,\n    side_of_highway TEXT,\n    tow_away REAL,\n    collision_severity TEXT,\n    killed_victims REAL,\n    injured_victims REAL,\n    party_count REAL,\n    primary_collision_factor TEXT,\n    pcf_violation_code TEXT,\n    pcf_violation_category TEXT,\n    pcf_violation REAL,\n    pcf_violation_subsection TEXT,\n    hit_and_run TEXT,\n    type_of_collision TEXT,\n    motor_vehicle_involved_with TEXT,\n    pedestrian_action TEXT,\n    road_surface TEXT,\n    road_condition_1 TEXT,\n    road_condition_2 TEXT,\n    lighting TEXT,\n    control_device TEXT,\n    chp_road_type TEXT,\n    pedestrian_collision INTEGER,\n    bicycle_collision INTEGER,\n    motorcycle_collision INTEGER,\n    truck_collision INTEGER,\n    not_private_property REAL,\n    alcohol_involved REAL,\n    statewide_vehicle_type_at_fault TEXT,\n    chp_vehicle_type_at_fault TEXT,\n    severe_injury_count INTEGER,\n    other_visible_injury_count INTEGER,\n    complaint_of_pain_injury_count INTEGER,\n    pedestrian_killed_count INTEGER,\n    pedestrian_injured_count INTEGER,\n    bicyclist_killed_count INTEGER,\n    bicyclist_injured_count INTEGER,\n    motorcyclist_killed_count INTEGER,\n    motorcyclist_injured_count REAL,\n    primary_ramp TEXT,\n    secondary_ramp TEXT,\n    latitude REAL,\n    longitude REAL,\n    collision_date TEXT,\n    collision_time TEXT,\n    process_date TEXT\n);\n\nCREATE TABLE case_ids (\n    case_id REAL,\n    db_year INTEGER\n);\n\nCREATE TABLE parties (\n    id INTEGER,\n    case_id REAL,\n    party_number INTEGER,\n    party_type TEXT,\n    at_fault INTEGER,\n    party_sex TEXT,\n    party_age REAL,\n    party_sobriety TEXT,\n    party_drug_physical TEXT,\n    direction_of_travel TEXT,\n    party_safety_equipment_1 TEXT,\n    party_safety_equipment_2 TEXT,\n    financial_responsibility TEXT,\n    hazardous_materials REAL,\n    cellphone_in_use REAL,\n    cellphone_use_type TEXT,\n    school_bus_related REAL,\n    oaf_violation_code TEXT,\n    oaf_violation_category TEXT,\n    oaf_violation_section REAL,\n    oaf_violation_suffix TEXT,\n    other_associate_factor_1 TEXT,\n    other_associate_factor_2 TEXT,\n    party_number_killed INTEGER,\n    party_number_injured INTEGER,\n    movement_preceding_collision TEXT,\n    vehicle_year REAL,\n    vehicle_make TEXT,\n    statewide_vehicle_type TEXT,\n    chp_vehicle_type_towing TEXT,\n    chp_vehicle_type_towed TEXT,\n    party_race TEXT\n);\n</DATABASE_SCHEMA>\n\n<QUESTION>\nIn which year were the two most common causes of traffic accidents different from those in other years?\n</QUESTION>"}]}, "instance_id": "local017", "db_id": "California_Traffic_Collision", "question": "In which year were the two most common causes of traffic accidents different from those in other years?", "gold_sql": "WITH AnnualTotals AS (\n    SELECT \n        STRFTIME('%Y', collision_date) AS Year, \n        COUNT(case_id) AS AnnualTotal\n    FROM \n        collisions\n    GROUP BY \n        Year\n),\nCategoryTotals AS (\n    SELECT \n        STRFTIME('%Y', collision_date) AS Year,\n        pcf_violation_category AS Category,\n        COUNT(case_id) AS Subtotal\n    FROM \n        collisions\n    GROUP BY \n        Year, Category\n),\nCategoryPercentages AS (\n    SELECT \n        ct.Year,\n        ct.Category,\n        ROUND((ct.Subtotal * 100.0) / at.AnnualTotal, 1) AS PercentageOfAnnualRoadIncidents\n    FROM \n        CategoryTotals ct\n    JOIN \n        AnnualTotals at ON ct.Year = at.Year\n),\nRankedCategories AS (\n    SELECT\n        Year,\n        Category,\n        PercentageOfAnnualRoadIncidents,\n        ROW_NUMBER() OVER (PARTITION BY Year ORDER BY PercentageOfAnnualRoadIncidents DESC) AS Rank\n    FROM\n        CategoryPercentages\n),\nTopTwoCategories AS (\n    SELECT\n        Year,\n        GROUP_CONCAT(Category, ', ') AS TopCategories\n    FROM\n        RankedCategories\n    WHERE\n        Rank <= 2\n    GROUP BY\n        Year\n),\nUniqueYear AS (\n    SELECT\n        Year\n    FROM\n        TopTwoCategories\n    GROUP BY\n        TopCategories\n    HAVING COUNT(Year) = 1\n),\nresults AS (\nSELECT \n    rc.Year, \n    rc.Category, \n    rc.PercentageOfAnnualRoadIncidents\nFROM \n    UniqueYear u\nJOIN \n    RankedCategories rc ON u.Year = rc.Year\nWHERE \n    rc.Rank <= 2\n)\n\nSELECT distinct Year FROM results", "ignore_order": true, "condition_cols": []}
